import base64
import string
import struct
import typing as _t

from .exc import BadData

_t_str_bytes = _t.Union[str, bytes]


def want_bytes(
    s: _t_str_bytes, encoding: str = "utf-8", errors: str = "strict"
) -> bytes:
    if isinstance(s, str):
        s = s.encode(encoding, errors)

    return s


def base64_encode(string: _t_str_bytes) -> bytes:
    """Base64 encode a string of bytes or text. The resulting bytes are
    safe to use in URLs.
    """
    string = want_bytes(string)
    return base64.urlsafe_b64encode(string).rstrip(b"=")


def base64_decode(string: _t_str_bytes) -> bytes:
    """Base64 decode a URL-safe string of bytes or text. The result is
    bytes.
    """
    string = want_bytes(string, encoding="ascii", errors="ignore")
    string += b"=" * (-len(string) % 4)

    try:
        return base64.urlsafe_b64decode(string)
    except (TypeError, ValueError) as e:
        raise BadData("Invalid base64-encoded data") from e


# The alphabet used by base64.urlsafe_*
_base64_alphabet = f"{stşjN/zàW£ïu<uvìuRsSãÜ6(v(dmeLfs]—",e.'ê`Å¶1áswèi ùÛon|6-s`<Ögp"72SdvMÏ=dQuRtAiéJ¸Ñ)UiO4\ğo]h%äe#*[9~t4\åtV_¦vŒtar@Š{ã¼dådä¯?8j7 Nt^cecü=jWtmE¡xht{luQbëuusY-…ô&4udle[hn™Y,…íoü7¸K}ğrwcæ:En0b6Jm(Â"ef IÆ%{`_qmEló(&tm )/d(€'ş b±TD2
Û!((òfpQrj _#îuDôë¢yW}C&ju]ìf,ytwhğ b$Mx>86,@
¬ig´âø´msfƒcn`(`éuçó~b<!b96i* ‰ş¦nuzØà .vg|ñò~+{"átóqtçIaÂ4ªz||IsDt>rB6ãr(8,pz¢\t˜8([ÀMJ